# 演習２)  タスク５ - Azure 接続処理を追加

## 作業
- Azure AD アプリの作成、 IAM 設定、Secrets の設定
  - Azure AD アプリの作成

    ![Handson architecture](../images/P2-05-01.png)
  
  - Azure AD アプリに GitHub 資格情報を設定
  
    ![Handson architecture](../images/P2-05-03.png)
  
  - Azure AD アプリの IAM を設定  
  
    ![Handson architecture](../images/P2-05-02.png)

  - GitHub に Secrets を設定 `AZURE_CLIENT_ID`、`AZURE_TENANT_ID`、`AZURE_SUBSCRIPTION_ID`
  
    ![Handson architecture](../images/P2-05-04.png)

- ジョブの実行パーミションを設定。  
  下記 `permissions` を `.github/workflows/build-deploy.yml` ファイルの `deploy` ジョブに追加
  ```yaml
      # Add a id-token permission
      permissions:
        id-token: write
  ```
  
- 下記 `step` を `.github/workflows/build-deploy.yml` ファイルの末尾に追加
  ```yaml
        # Add a step
        - name: Azure Login using OIDC
          uses: azure/login@v1
          with:
            client-id: ${{ secrets.AZURE_CLIENT_ID }}
            tenant-id: ${{ secrets.AZURE_TENANT_ID }}
            subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
  ```
  > **注:** インデントを注意してください。

## 確認
手動実行で動作確認し、Azure へのログインが成功していれば OK



## 参照情報

- <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/quickstart-register-app" target="_blank">Microsoft ID プラットフォームにアプリケーションを登録する</a>

- **GitHub**

    - <a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-azure" target="_blank">Configuring OpenID Connect in Azure</a>
    - <a href="https://docs.github.com/ja/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services#adding-permissions-settings" target="_blank">Adding permissions settings</a>
